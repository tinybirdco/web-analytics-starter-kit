DESCRIPTION >
	Returns web vitals performance distribution across excellent, good, and poor ranges with average values and percentage of measurements in each category. Shows how measurements are distributed across performance thresholds for each Core Web Vitals metric over a configurable time period (defaults to 1 day) with optional domain filtering.

TOKEN "dashboard" READ

NODE filtered_vitals
DESCRIPTION >
    Filter web vitals data for the specified time period and domain

SQL >

    %
    SELECT
        metric_name,
        value,
        performance_category,
        score,
        units
    FROM web_vitals_events
    WHERE timestamp >= now() - interval {{Int32(days, 1, description="Number of days to analyze (defaults to 1 day)")}} day
        {% if defined(domain) %}
        AND domain = {{ String(domain, description="Domain to filter web vitals for") }}
        {% end %}
        AND performance_category != 'unknown'

NODE endpoint
DESCRIPTION >
    Calculate distribution statistics and average values for each metric and performance category

SQL >

    WITH category_stats AS (
        SELECT
            metric_name,
            performance_category,
            round(avg(value), 2) as avg_value,
            count() as measurement_count,
            any(score) as score,
            any(units) as units
        FROM filtered_vitals
        GROUP BY metric_name, performance_category
    ),
    metric_totals AS (
        SELECT
            metric_name,
            sum(measurement_count) as total_measurements
        FROM category_stats
        GROUP BY metric_name
    )
    SELECT
        cs.metric_name,
        cs.performance_category,
        cs.avg_value,
        cs.measurement_count,
        round((cs.measurement_count * 100.0) / mt.total_measurements, 1) as percentage,
        mt.total_measurements,
        cs.score,
        cs.units,
        multiIf(
            cs.metric_name = 'LCP', 'Excellent: ≤2500ms, Good: ≤4000ms, Poor: >4000ms',
            cs.metric_name = 'TTFB', 'Excellent: ≤500ms, Good: ≤1000ms, Poor: >1000ms',
            cs.metric_name = 'FCP', 'Excellent: ≤1800ms, Good: ≤3000ms, Poor: >3000ms',
            cs.metric_name = 'INP', 'Excellent: ≤200ms, Good: ≤500ms, Poor: >500ms',
            cs.metric_name = 'CLS', 'Excellent: ≤0.1, Good: ≤0.25, Poor: >0.25',
            'Unknown thresholds'
        ) as thresholds,
        multiIf(
            cs.metric_name = 'LCP', 'Largest Contentful Paint - measures loading performance',
            cs.metric_name = 'TTFB', 'Time to First Byte - measures server response time',
            cs.metric_name = 'FCP', 'First Contentful Paint - measures rendering performance',
            cs.metric_name = 'INP', 'Interaction to Next Paint - measures interactivity',
            cs.metric_name = 'CLS', 'Cumulative Layout Shift - measures visual stability',
            'Unknown metric'
        ) as description
    FROM category_stats cs
    JOIN metric_totals mt ON cs.metric_name = mt.metric_name
    ORDER BY 
        cs.metric_name,
        CASE cs.performance_category 
            WHEN 'excellent' THEN 1 
            WHEN 'good' THEN 2 
            WHEN 'poor' THEN 3 
            ELSE 4 
        END

TYPE endpoint